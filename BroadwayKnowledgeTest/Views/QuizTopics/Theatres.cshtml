
@{
    ViewData["Title"] = "Theatres";
}

<h2>Theatres</h2>

<div id="totalScore"></div>

<div>
    <div class="row">
        <section data-quiz-item>
            <div class="question">Which of the following Theatres is the oldest operating theatre on Broadway?</div>
            <div class="choices" data-choices='["The Lyceum Theatre", "The Richard Rodgers Theatre", "The Brooks Atkinson Theatre", "The New Amsterdam Theatre"]'>
            </div>
        </section>
    </div>
    <div class="submit">
        <button id="submitButton">Submit Answers</button>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    (function ($) {
        $.fn.quiz = function (options) {

            var defaults = {
                key: [],
                scoring: "normal",
                progress: true
            },
                settings = $.extend(defaults, options),
                $quizItems = $('[data-quiz-item]'),
                $choices = $('[data-choices]'),
                itemCount = $quizItems.length,
                chosen = [],
                $option = null,
                $label = null;

            initializeQuiz();

            if (settings.progress) {
                var $bar = $('#emc-progress'),
                    $inner = $('<div id="emc-progress_inner"></div>'),
                    $perc = $('<span id="emc-progress_ind">0/' + itemCount + '</span>');
                $bar.append($inner).prepend($perc);
            }

            //all functions for the quiz

            function initializeQuiz() {
                $quizItems.each(function (index, value) {
                    var $this = $(this),
                        $choiceEl = $this.find('.choices'),
                        choices = $choiceEl.data('choices');
                    for (var i = 0; i < choices.length; i++) {
                        $option = $('<input name="' + index + '" id="' + index + '_' + i + '" type="radio">');
                        $label = $('<label for="' + index + '_' + i + '">' + choices[i] + '</label>');
                        $choiceEl.append($option).append($label);

                        $option.on('change', function () {
                            return getChosen();
                        });
                    }
                });
            }

            function getChosen() {
                chosen = [];
                $choices.each(function () {
                    var $inputs = $(this).find('input[type="radio"]');
                    $inputs.each(function (index, value) {
                        if ($(this).is(':checked')) {
                            chosen.push(index + 1);
                        }
                    });
                });
                getProgress();
            }

            
            function getProgress() {
                var prog = (chosen.length / itemCount) * 100 + "%",
                    $submit = $('#submitButton');
                if (settings.progress) {
                    $perc.text(chosen.length + '/' + itemCount);
                    $inner.css({ height: prog });
                }
                if (chosen.length === itemCount) {
                    $submit.addClass('ready-show');
                    $submit.click(function () {
                        return scoreNormal();
                    });
                }
            }
            

            function scoreNormal() {
                var wrong = [],
                    score = null,
                    $scoreEl = $('#totalScore');
                for (var i = 0; i < itemCount; i++) {
                    if (chosen[i] != settings.key[i]) {
                        wrong.push(i);
                    }
                }
                $quizItems.each(function (index) {
                    var $this = $(this);
                    if ($.inArray(index, wrong) !== -1) {
                        $this.removeClass('item-correct').addClass('item-incorrect');
                    } else {
                        $this.removeClass('item-incorrect').addClass('item-correct');
                    }
                });

                score = ((itemCount - wrong.length) / itemCount).toFixed(2) * 100 + "%";
                $scoreEl.text("You scored a " + score).addClass('new-score');
                $('html,body').animate({ scrollTop: 0 }, 50);
            }

        }
    }(jQuery));


    $(document).quiz({
        key: ["1"] //stands for each answer, 1=choice 1, 2=choice 2, etc.
    });
</script>

